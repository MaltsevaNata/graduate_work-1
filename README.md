
# Биллинг сервис
- ### Описание задачи:
"Нужно сделать два метода работы с картами: оплатить подписку и вернуть за неё деньги. При этом система должна быть устойчивой к перебоям: не должно происходить двойных списаний, и чтобы у пользователя всегда была гарантия, что операция выполнилась. Помимо реализации системы, интегрируйте эту систему с админкой Django, чтобы вы могли контролировать оплату подписок клиентами."

- ### Ознакомиться со структурой проекта можно [тут](https://miro.com/app/board/o9J_lsATuns=/?invite_link_id=410429303384). <br/>
После запуска проекта, сервисы будут доступны тут: [админка](http://127.0.0.1:8002/admin/) с доступом admin/password,
[subscription api](http://127.0.0.1:8001/api/openapi#/) и [payments api](http://127.0.0.1:8000/api/openapi#/).

## Как это запустить
- ### поднять всё с батарейками:
```shell
make all
```

- ### инфраструктура для разработки:
```shell
make dev
```

- ### инициаилазция баз данных и запуск миграций:
```shell
make init_db
```

- ### запуск тестов:
```shell
make test
```

Создается новый контейнер постгри, инициализируются базы и миграции, после запуска тестов
удаляются все контейнеры

- ### локальный запуск user subscription api
После поднятия инфраструктуры, нужно задать путь к приложению
и выполнить миграции.

Можно воспользоваться скриптом:
```shell
cd ./subscription_api
./prestart.sh
```
Либо выполнить руками:
```shell
cd ./subscription_api
export PYTHONPATH=$(readlink -f ./)
alembic upgrade head
```
# FAQ
1. **О авторизации**.
Сейчас для простоты используем HS256 и храним секретный ключ в приложении. 
   Заготовка для работы с RS256 и получением публичного ключа от сервиса
   авторизации есть, но постоянно держать запущенным сервис авторизации неудобно.
   
2. **О snake style в апишке**. Досадный недочёт, бага на исправление заведена.
3. **O TODO и FIXME в коде**. Очень спешили отправить на ревью,
   не всё получилось сделать красиво.
   
